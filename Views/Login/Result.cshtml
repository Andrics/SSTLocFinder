@model string

<h2>Username Found</h2>
<p>Your username is: <strong id="username">@Model</strong></p>

<button type="button" onclick="getLocation()">Get Location</button>

<div id="map" style="height:400px;width:100%;margin-top:20px;"></div>
<p id="address" style="margin-top:10px;"></p>

<a href="/">Back</a>

<script>
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }

    function showPosition(position) {
        let lat = position.coords.latitude;
        let lng = position.coords.longitude;

        // Show Google Map
        let map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: lat, lng: lng },
            zoom: 15
        });
        new google.maps.Marker({ position: { lat: lat, lng: lng }, map: map });

        // Get address via Google Geocoding API
        fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=AIzaSyBmzDp3DQ7tYleZhhiKGeUz3dBBChMnKAk`)
            .then(response => response.json())
            .then(data => {
                if (data.status === "OK") {
                    let address = data.results[0].formatted_address;
                    document.getElementById("address").innerText = address;

                    // Save location to the server
                    let username = document.getElementById("username").innerText;
                    fetch('/Login/SaveLocation', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            username: username,
                            latitude: lat,
                            longitude: lng,
                            address: address
                        })
                    });
                }
            });
    }

    function showError(error) {
        alert("Unable to retrieve location: " + error.message);
    }
</script>

<!-- Load Google Maps JavaScript API -->
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBmzDp3DQ7tYleZhhiKGeUz3dBBChMnKAk">
</script>
